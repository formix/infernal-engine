<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: engine-proxy.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: engine-proxy.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";

var utils = require("./utils");


module.exports = EngineProxy;

/**
 * Creates an engine proxy class to hold a rule context of execution.
 * @class
 * @param {InfernalEngine} engine - The engine being proxied.
 * @param {string} - the rule name that will execute under the EngineProxy 
 *                   context.
 */
function EngineProxy(engine, ruleName) {
    this.engine = engine;
    this.ruleName = ruleName;
    this.context = utils.getContext("/", ruleName);
}


/**
 * Gets the fact value for the given factName. Note that the factName can be 
 * a relative path to the current rule context. Usage of ".." allows to go
 * up the context stack to reach parents and sibling facts.
 *
 * @param {string} factName - The fact name.
 * 
 * @returns {*} The fact value.
 */
EngineProxy.prototype.get = function(factName) {
    var fullFactName = utils.getFullName(this.context, factName);
    return this.engine.get(fullFactName);
};


/**
 * Sets a fact value for the given fact name. The fact name can be a relative 
 * path. See {@link EngineProxy#get} for details.
 *
 * @oaram {string} factName - the fact name.
 * @param {*} value - The value to set to the fact.
 *
 * @returns {EngineProxy} A reference to "this" object for method chaining.
 */
EngineProxy.prototype.set = function(factName, value) {

    if ((typeof this.engine._trace === "function") &amp;&amp; !utils.equals(oldValue, value)) {
        var self = this;
        process.nextTick(function() {
            self.engine._trace({
                action: "set",
                fromRule: self.ruleName,
                fact: fullFactName,
                oldValue: oldValue,
                newValue: value
            });
        });
    }

    var fullFactName = utils.getFullName(this.context, factName);
    var oldValue = this.engine.get(fullFactName);
    this.engine.set(fullFactName, value);

    return this;
};

/**
 * Notifies that the given fact has changed. The fact name can be a relative 
 * path. See {@link EngineProxy#get} for details.
 *
 * @param {string} factName - The fact name.
 *
 * @returns {EngineProxy} A reference to "this" object for method chaining.
 */
EngineProxy.prototype.notify = function(factName) {
    var fullFactName = utils.getFullName(this.context, factName);
    this.engine.notify(fullFactName);
    return this;
};


/**
 * This method sends a trace message to the tracing function, if tracing 
 * is activated.
 *
 * @param {string} message - The message to send to the trace function.
 *
 * @returns {EngineProxy} A reference to "this" object for method chaining.
 */
EngineProxy.prototype.trace = function(message) {
    if (typeof this.engine._trace === "function") {
        var self = this;
        process.nextTick(function() {
            self.engine._trace({
                action: "trace",
                rule: self.ruleName,
                message: message
            });
        });
    }
    return this;
}


// private
EngineProxy.prototype._executeRule = function(callback) {
    let rule = this.engine._rules[this.ruleName];
    let params = [callback];
    rule.inputFacts.forEach(factName => {
        params.push(this.engine.get(factName))
    });
    rule.run.apply(this, params);
    return this;
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Agenda.html">Agenda</a></li><li><a href="EngineProxy.html">EngineProxy</a></li><li><a href="InfernalEngine.html">InfernalEngine</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Sun Oct 04 2020 21:00:59 GMT-0400 (heure avancée de l’Est)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
